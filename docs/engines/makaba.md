# `2ch.hk` API

## Определения

### Board

Полная информация о доске.

```js
{
  // ID доски.
  "Board": "vg",
  "BoardInfo": "Доска для постоянных тредов по игре",
  "BoardInfoOuter": "Видеоигры, general, официальные треды", // хз
  // Название доски.
  "BoardName": "Video Games General",

  // Рекламный баннер сверху.
  "advert_top_image": "/banners/bDpQCWt8xPTuC43S.jpg",
  // Рекламный баннер сверху.
  "advert_top_link": "/banners/bDpQCWt8xPTuC43S/",

  // Рекламный баннер снизу.
  "advert_bottom_image": "/banners/AZMtfxdMbkGwpPXB.jpg",
  // Ссылка рекламного баннера снизу.
  "advert_bottom_link": "/banners/AZMtfxdMbkGwpPXB/",

  // Рекламный баннер (мобильные устройства).
  "advert_mobile_image": "/banners/S4BcqS4adse3B2Cb.jpg",
  // Рекламный баннер (мобильные устройства).
  "advert_mobile_link": "/banners/S4BcqS4adse3B2Cb/",

  // Сколько постов можно написать в тред данной доски
  // до тех пор, пока тред не перестанет от них "бампаться" (подниматься).
  "bump_limit": 1000,

  // Имя автора поста по умолчанию.
  "default_name": "Аноним",

  "enable_dices": 0, // Возможно, разрешены ли некие "ролл", хз.
  "enable_flags": 0, // Показываются ли "флаги" (страны) у постов на данной доске.
  "enable_icons": 0, // Разрешены ли "значки" (например, флажки политической ориентации в `/po/`) у постов на данной доске. При отправке поста в форме можно выбрать "значок" из списка.
  "enable_images": 1, // Видимо, можно ли прикреплять к постам картинки на этой доске.
  "enable_likes": 0, // Можно ли ставить лайки/дизлайки на этой доске.
  "enable_names": 0, // Есть ли поле "Имя" в форме отправки сообщения на данной доске.
  "enable_oekaki": 0, // Видимо, можно ли рисовать "оэкаки" на этой доске.
  "enable_posting": 1, // Видимо, можно ли постить на этой доске.
  "enable_sage": 0, // Видимо, можно ли "сагать" на этой доске (ответ с "сажей" ("sage", см. ниже) не "бампает" тред).
  "enable_shield": 0, // Возможно, включён ли какой-нибудь спам-лист (или что-то типа того) на этой доске.
  "enable_subject": 1, // Показывать ли поле "Тема" в форме отправки сообщения или создания треда на данной доске.
  "enable_thread_tags": 1, // Можно ли помечать треды тегами на данной доске.
  "enable_trips": 0, // Разрешены ли "трип-коды" в поле "Имя" при отправке сообщений на данной доске.
  "enable_video": 1, // Видимо, можно ли прикреплять к постам видео (.webm) на этой доске.

  // (Не обязательное поле)
  // (Только если `"enable_icons": 1`)
  // Список значков, используемых на данной доске.
  "icons": [{
    // Название значка.
    "name": "﻿Амкар",
    // ID значка.
    "num": 1,
    // (Не обязательное поле)
    // Путь к значку.
    "url": "/icons/logos/amkar.png"
  }, ...]

  // Максимальная длина комментария.
  "max_comment": 15000,
  // Максимальный размер прикрепляемого файла.
  "max_files_size": 40960,
  // ID самого "последнего" (на текущий момент) поста в треде.
  "max_num": 3489385,

  // Баннер случайной доски.
  "board_banner_image": "/ololo/kpop_7.gif",
  // Ссылка баннера случайной доски.
  "board_banner_link": "kpop",

  // `0` для API тредов, `1` для API досок.
  "is_board": 0,
  // `1`, если это ответ на API постраничного списка тредов доски.
  "is_index": 0,
}
```

### Post

```js
{
  // ID поста.
  "num": 29102706,

  // Дата написания поста ("unix time").
  "timestamp": 1549035324,

  // "Человекочитаемая" дата написания поста.
  "date": "01/02/19 Птн 18:35:24",

  // Если "1", то данный пост написан человеком,
  // создавшим тред с галкой "ОП треда",
  // и запостившим это сообщение с галкой "ОП треда".
  // Подробности — в подразделе "ОП треда".
  // Также, "op" будет "1" у всех постов, оставленных
  // человеком, создавшим тред, если в треде показываются
  // id пользователей (наипример, треды в `/po/`).
  "op": 0,

  // Имя автора поста.
  "name": "Аноним",

  // "email" автора поста (с префиксом "mailto:").
  // Пример: "mailto:admin@example.com".
  "email": "",

  // "Трип-код" автора поста.
  // Для администраторов и модераторов тут ставится соответствующая метка.
  "trip": "",
  "subject": "Четырнадцатый двачкап", // "Тема" поста.
  "comment": "Скинул на почту", // HTML-код комментария.
  "files": [], // Список объектов типа `Attachment`.

  // Забанен ли автор поста за данный пост.
  "banned": 0,

  // Закрыт ли этот тред.
  "closed": 0,

  // Является ли тред "бесконечным".
  // "Бесконечный" тред — это тред, не имеющий "бамплимита"
  // ("бампается" при любом ответе в нём), но при этом максимальное
  // количество постов в треде ограничено бамплимитом доски (например, 500 шт.),
  // и при добавлении в тред новых постов наиболее старые из существующих автоматически удаляются.
  "endless": 0,

  // Видимо, `timestamp` комментария, который является
  // (на текущее время) "последним", "бампающим" данный тред.
  // Например, первый комментарий в треде, или 500-ый комментарий
  // в треде с "бамп-лимитом" в 500 и количеством постов больше 500.
  // Одно и то же значение у всех постов треда.
  // Также, возможно, является датой "последнего изменения" треда:
  // например, добавление постов, удаление постов, изменения статуса
  // "прикреплён"/"не прикреплён", и т.п., потому что так это работает
  // на `4chan.org` (там это называется `last_modified`).
  "lasthit": 1549117714,

  // Закреплён ли этот тред наверху в списке тредов доски.
  // Если не `0`, то может быть как `1`, так и любое другое целое положительное число.
  // (хз, какой смысл это может нести).
  "sticky": 0,

  // (только у первого поста треда)
  // Теги треда. Пустая строка, если не указано тегов.
  "tags": "lolcup",

  // id треда данного поста (в виде строки).
  // "0" для первого поста треда, для остальных постов —
  // одно и то же значение: id треда, он же id первого поста треда.
  "parent": "0",

  // (optional)
  // Только для тредов с "лайками":
  "likes": 1, // Количество "лайков" у поста.
  "dislikes": 1, // Количество "дизлайков" у поста.
}
```

### Thread

id треда — это id первого поста треда.

```js
{
  "posts": [] // Список объектов типа `Post`.
}
```

### Attachment

Картинка или видео, прикреплённые к посту.

```js
{
  // Тип файла (1 — jpeg, 2 — png, 4 — gif, 6 - webm, 10 — mp4, 100 — png стикер).
  "type": 2,
  // Помечена ли эта картинка как "NSFW" ("18+").
  "nsfw": 0,
  // Размер картинки или видео в килобайтах.
  // `0` для "стикеров".
  "size": 1611,

  // Ширина картинки или видео.
  "width": 1363,
  // Высота картинки или видео.
  "height": 768,

  // Имя файла (ограниченное по длине).
  "displayname": "photo2018-10-27[...]..png",
  // Имя файла (отсутствует для "стикеров"").
  "fullname": "photo2018-10-2705-29-50.png",
  // Имя файла на сервере.
  "name": "15490353246680.png",
  // URL картинки или видео.
  "path": "/vg/src/29102706/15490353246680.png",

  // MD5 хеш файла.
  "md5": "bc441048422b76dd41d626e1420fa0f7",

  // URL уменьшенной картинки.
  "thumbnail": "/vg/thumb/29102706/15490353246680s.jpg",
  // Ширина уменьшенной картинки.
  "tn_width": 250,
  // Высота уменьшенной картинки.
  "tn_height": 140,

  // (только для видео)
  // "Человекочитаемая" длительность видео.
  "duration": "00:00:53",
  // (только для видео)
  // Длительность видео в секундах.
  "duration_secs": 53

  // (только для "стикеров")
  // (пример)
  "install": "/makaba/stickers/show/HycdNR0H"
  "name": "ygfyCF0H.png"
  "pack": "HycdNR0H"
  "sticker": "ygfyCF0H"
}
```

Размеры миниатюр не определены: по умолчанию они ограничены `250` пикселями, в `/b/` они ограничены `220` пикселями. Иногда встречаются миниатюры, ограниченные `200` пикселями, рядом с миниатюрами, ограниченными `250` пикселями.

<!-- В любом случае, качество миниатюр очень низкое (особенно это видно на экранах "ретина"), поэтому `captchan` по умолчанию использует размер в `200` пикселей. -->

## Синтаксис

HTML синтаксис сообщений:

* `<strong>...</strong>` — жирный текст.
* `<em>...</em>` — курсивный текст.
* `<b>...</b>` — жирный текст (иногда бывает и такой, если кто-то вручную пишет HTML код: например, модераторы в "закреплённых" постах).
* `<i>...</i>` — жирный текст (иногда бывает и такой, если кто-то вручную пишет HTML код: например, модераторы в "закреплённых" постах).
* `<sub>...</sub>` — нижний индекс.
* `<sup>...</sup>` — верхний индекс.
* `<span class="s">...</span>` — зачёркнутый текст.
* `<span class="u">...</span>` — подчёркнутый текст.
* `<span class="o">...</span>` — надчёркнутый текст.
* `<span class="spoiler">...</span>` — спойлер.
* `<span class="unkfunc">...</span>` — цитируемый текст (начинается с `>`).
* `<div class="quote">...</div>` — возможно, ещё один вариант цитируемого текста (хз, где я его видел).
* `<a href="..." data-thread="12345" data-num="12367">...</a>` — ссылка на сообщение (`data-thread` — ID треда, `data-num` — ID поста) (начинается с `>>`).
* Также модераторы имеют полномочия писать на чистом HTML коде (например, в "прикреплённых" сообщениях), и возможны любые теги, например: `<div/>`, `<p/>`, `<h1/>`, `<style/>`, `<script/>`, `<table/>`, `<tr/>`, `<td/>`, и тому подобные, так что любые нестандартные/невалидные теги следует игнорировать, просто показывая их содержимое (которое, в свою очередь, также может содержать нестандартные/невалидные теги).

## Адреса API

### Список постов треда

`https://2ch.hk/<доска>/res/<номер-треда>.json`

```js
{
  // Содержит все свойства объекта `Board`.

  "current_thread": "12345", // id запрошенного треда.
  "posts_count": 123, // Количество постов в треде.
  // `files_count` вообще считается неправильно: как в `/catalog.json`, так и при запросе "получить посты треда". И в обоих этих случаях — ещё и по-разному.
  // https://gitlab.com/catamphetamine/imageboard/blob/master/docs/engines/makaba-issues.md
  "files_count": 3, // Количество файлов, прикреплённых к постам треда (в данном случае, включая файлы заглавного поста, в отличие от `/catalog.json`, где они не включены).
  "unique_posters": 7, // Количество "уникальных" (по хешу подсети) пользователей, написавших комментарий в треде. Не включая заглавный пост треда по неведомой причине: автор треда посчитается только если он оставит комментарий в треде.
  "is_closed": 0, // `1`, если тред закрыт.

  "title": "...", // Название треда. Видимо, то же самое, что `posts[0].subject`.

  "threads": [{
    // Список объектов типа `post`.
    "posts": [
      {
        // Содержит все поля объекта `post`.

        "number": 1, // Порядковый номер поста в треде, начиная с `1`.
      },
      ...
    ]
  }]
}
```

### Список постов треда, начиная с id поста

[`https://2ch.hk/makaba/mobile.fcgi?task=get_thread&board=abu&thread=1&num=1`](https://2ch.hk/makaba/mobile.fcgi?task=get_thread&board=abu&thread=1&num=1)

Параметры:

* `board` — id доски.
* `thread` — id треда.
* `num` — id поста, начиная с корого будет список постов в ответе.

Ответ: Список объектов типа [`Post`](#post).

### Список постов треда, начиная с порядкового номера поста в треде

[`https://2ch.hk/makaba/mobile.fcgi?task=get_thread&board=abu&thread=39220&post=252`](https://2ch.hk/makaba/mobile.fcgi?task=get_thread&board=abu&thread=39220&post=252)

Параметры:

* `board` — id доски.
* `thread` — id треда.
* `num` — порядковый номер поста в треде, начиная с корого будет список постов в ответе.

Ответ: Список объектов типа [`Post`](#post).

### Список тредов доски

`https://2ch.hk/<доска>/<номер-страницы>.json`

Параметры:

* `<номер-страницы>` — `index` для первой страницы, далее `1`, `2`, ...

```js
{
  "Board": "b",
  "BoardInfo": "",
  // И все остальные поля, как в ответе API "Список постов треда".
  "is_board": 1,
  "pages": [0, 1, 2, 3, ...], // Список страниц тредов доски.
  "threads": [{
    // `files_count` вообще считается неправильно: как в `/catalog.json`, так и при запросе "получить посты треда". И в обоих этих случаях — ещё и по-разному.
    // https://gitlab.com/catamphetamine/imageboard/blob/master/docs/engines/makaba-issues.md
    "files_count": 0, // Количество файлов, прикреплённых к постам треда (вероятно, не включая файлы заглавного поста).
    "posts_count": 27, // Количество комментариев в треде (не включая заглавный пост).
    "thread_num": "3475861", // id треда. Почему-то в виде строки.
    "posts": [] // Список объектов типа `post`.
  }]
}
```

### Список тредов доски с сортировкой по дате последнего поста

[`https://2ch.hk/b/catalog.json`](https://2ch.hk/b/catalog.json)

Выводит список тредов, упорядоченных по дате "последнего" (на текущий момент) поста в них (самые новые — сверху).

`threads` — список "тредов", где "тред" — первый пост треда, то есть объект типа [`Post`](#post)

```js
{
  "Board": "b",
  "BoardInfo": "",
  // ... И все остальные поля, как в ответе API "Список постов треда".
  "threads": [{
    // `files_count` вообще считается неправильно: как в `/catalog.json`, так и при запросе "получить посты треда". И в обоих этих случаях — ещё и по-разному.
    // https://gitlab.com/catamphetamine/imageboard/blob/master/docs/engines/makaba-issues.md
    "files_count": 0, // Количество файлов, прикреплённых к комментариям треда (не включая файлы заглавного поста).
    "posts_count": 27, // Количество комментариев в треде (не включая заглавный пост).
    // А также все свойства объекта типа `Post`.
    ...
  }, ...]
}
```

### Список тредов доски с сортировкой по времени создания треда

[`https://2ch.hk/b/catalog_num.json`](https://2ch.hk/b/catalog_num.json)

```js
{
  "Board": "b",
  "BoardInfo": "",
  // И все остальные поля, как в ответе API "Список постов треда".
  "threads": [] // Список объектов типа `Post`.
}
```

### Список тредов доски (облегченный вариант, с просмотрами и рейтингом для "топа тредов")

[`https://2ch.hk/b/threads.json`](https://2ch.hk/b/threads.json)

```js
{
  threads: [{
    "num": "3475861", // id треда.
    "score": 17.8347107438, // "Рейтинг" треда.
    "views": 2159, // Количество просмотров треда.
    "posts_count": 374, // Количество постов в треде.
    "timestamp": 1540597950, // Дата создания треда (unix timestamp).
    "subject": "Во что играем?", // Тема треда.
    "comment": "ИТТ описываем свои похождения, ...", // Первый пост треда.
    "lasthit": 1541028071, // Видимо, то же самое, что и `lasthit` у объекта типа `Post`.
  },
  ...]
}
```

### Список досок

[`https://2ch.hk/boards.json`](https://2ch.hk/boards.json)

```js
{
  "global_boards": 158, // Количество досок.
  "global_posts": "363,061,097\u0000", // Количество постов на дваче.
  "global_speed": "1,406\u0000", // Количество постов на дваче в час.
  "is_index": 1, // Видимо, всегда `1`.
  "boards": [
    {
      "bump_limit": 500,
      "category": "Разное",
      "default_name": "Аноним",
      "enable_names": 0,
      "enable_sage": 1,
      "id": "b",
      "info": "бред",
      "last_num": 190778973,
      "name": "Бред",
      "speed": 2690, // Количество постов на доске в час.
      "threads": 210,
      "unique_posters": 4137
    },
    {
      "bump_limit": 500,
      "category": "Взрослым",
      "default_name": "Аноним",
      "enable_names": 1,
      "enable_sage": 1,
      "id": "fag",
      "info": "фагготрия, богини",
      "last_num": 6924268,
      "name": "Фагготрия",
      "speed": 734, // Количество постов на доске в час.
      "threads": 105,
      "unique_posters": 2194
    },
    ...
  ]
}
```

### Список "пользовательских" досок

https://2ch.hk/userboards.json

```js
{
  "boards": [{
    "id": "2d",
    "info": "Щитпостинг, обсуждение вайфу, аватарки и прочее. Анимешный /b/, постинг 3d не приветствуется.",
    "last_num": "793813",
    "name": "Аниме/Беседка",
    "speed": 15, // Количество постов на доске в час.
    "threads": 401
  },
  ...]
}
```

### Список досок (по категориям)

https://2ch.hk/makaba/mobile.fcgi?task=get_boards

```js
{
  "Взрослым": [{
    "bump_limit": 500,
    "category": "Взрослым",
    "default_name": "Аноним", // "уточка"
    "id": "fag",
    "name": "Фагготрия",
    "pages": 7,
    // Значки, используемые на этой доске.
    "icons": [{
      "name": "﻿Амкар",
      "num": 1,
      "url": "/icons/logos/amkar.png"
    }, ...]
  },
  ...],
  "Пользовательские": [{
    ...
  },
  ...],
  ...
}
```

### Поиск по всем постам доски

https://2ch.hk/makaba/makaba.fcgi

`FormData`:

* `board` — "b"
* `task` — "search"
* `find` — "текст"

## Постинг

Постинг на `2ch.hk` требует либо наличия "пасскода", либо разгадывания капчи. `2ch.hk` позволяет [выбрать капчу на свой вкус из нескольких возможных](https://www.google.com/search?q=%D0%B0%D0%BA%D1%81%D0%B8%D0%BE%D0%BC%D0%B0+%D1%8D%D1%81%D0%BA%D0%BE%D0%B1%D0%B0%D1%80%D0%B0&oq=%D0%B0%D0%BA%D1%81%D0%B8%D0%BE%D0%BC%D0%B0+%D1%8D%D1%81). Для получения списка возможных капч можно отправлять `GET` запрос на адрес `https://2ch.hk/api/captcha/settings/<id-доски>`. Пример ответа:

```js
{
  // `1` означает, что капча требуется для постинга на этой доске.
  "enabled": 1,

  // ???
  "result": 1,

  // Возможные виды капч на этой доске.
  "types": [
    {
      // Капча истекает, если её не разгадать за указанное количество секунд.
      "expires": 360,
      // Вид капчи — reCAPTCHA.
      "id": "recaptcha"
    },
    {
      // Капча истекает, если её не разгадать за указанное количество секунд.
      "expires": 360,
      // Вид капчи — Invisible reCAPTCHA.
      "id": "invisible_recaptcha"
    }
  ]
}
```

[Документация по Invisible reCAPTCHA](https://developers.google.com/recaptcha/docs/invisible)

После того, как выбран вид капчи, требуется получить ID капчи для разгадывания с сервера `2ch.hk`. Для этого отправляется `GET` запрос по адресу: `https://2ch.hk/api/captcha/<выбранный-вид-капчи>/id`

Пример ответа:

```js
{
  id: "6LdwXD4UAAAAAHxyTiwSMuge1-pf1ZiEL4qva_xu",
  result: 1,
  type: "invisible_recaptcha"
}
```

Пример ответа, когда применён ["пасскод"](#пасскод):

```js
{
  description: "Captcha not required: you have VIP account.",
  result: 2
}
```

Полученный `id` капчи используется для показа капчи пользователю для её разгадывания.

### Отправка сообщения в тред

Для отправки сообщения в тред оправляется `POST` запрос по адресу `https://2ch.hk/makaba/posting.fcgi?json=1` с данными формы:

* `task`: `"post"`.
* `board`: ID доски. Пример: `"b"`.
* `thread`: ID треда. Пример: `194336016`.
* `op_mark`: Галка "ОП треда" формы отправки сообщения в тред. Подробности — в подразделе ["ОП треда"](#оп-треда). Пример в случае проставленной галки "ОП треда": `1`. Можно оставить пустым.
* `usercode`: "Пасскод". Можно оставить пустым.
* `code`: Судя по всему, не используется.
* `captcha_type`: Выбранный вид капчи. Пример: `"invisible_recaptcha"`
* `email`: Электронная почта пользователя. Примеры: `"admin@example.com"`, `"sage"`. На некоторых досках (например, `/b/`) в форме отправки сообщения нет поля "Имя", и имя можно вписать в поле "Email", например: `"Анон"`. Можно оставить пустым.
* `name`: Имя пользователя. Пример: `"Анон"`. На некоторых досках (например, `/b/`) в форме отправки сообщения нет поля "Имя". Можно оставить пустым.
* `subject`: Тема сообщения. На некоторых досках (например, `/b/`) в форме отправки сообщения нет поля "Тема". Можно оставить пустым.
* `icon`: На некоторых досках можно прикреплять "значки" к отправляемым сообщениям. Например, в `/po/` разрешены значки политической ориентации: "Коммунизм", "Родноверие", и т.п. Возможные значения: число (ID значка), или `-1`, если значок не выбран.
* `comment`: Текст отправляемого комментария. Можно оставить пустым.
* `formimages[]`: Список вложений, прикреплённых к отправляемому комментарию. Двоичные данные (стандартная отправка файлов в составе HTTP `POST` запроса). Можно оставить пустым.
* `oekaki_image`: Видимо, используется для отправки рисунков ["оэкаки"](http://lurkmore.to/%D0%9E%D1%8D%D0%BA%D0%B0%D0%BA%D0%B8). Можно оставить пустым.
* `oekaki_metadata`: Видимо, используется для отправки рисунков ["оэкаки"](http://lurkmore.to/%D0%9E%D1%8D%D0%BA%D0%B0%D0%BA%D0%B8). Можно оставить пустым.
* `g-recaptcha-response`: (только в случае использования капчи reCAPTCHA) Ответ разгаданной капчи reCAPTCHA.
* `2chaptcha_id`: ID капчи, который был получен ранее с сервера `2ch.hk`.

Пример ответа без ошибки:

```js
{
  "Error": null,
  "Status": "OK",
  "Num": 194338603
}
```

Где:

* `Error` — Код ошибки (в данном случае ошибки не произошло).
* `Status` — Всегда `"OK"`.
* `Num` — ID отправленного сообщения.

При возникновении ошибки "статус" HTTP ответа будет тоже `200`, кроме ошибки "тред не найден", при которой "статус" HTTP ответа будет `404`.

Пример ответа с ошибкой:

```js
{
  "Error": -8,
  "Reason": "Вы постите слишком быстро."
}
```

Где:

* `Error` — Код ошибки.
* `Reason` — Пояснение ошибки.

Возможные коды ошибок (источник — [`2ch-wiper`](https://github.com/tsunamaru/2ch-wiper/issues/1#issuecomment-480646513)):

* `-1`: `"База данных недоступна."`. Случается редко: когда у макабы падает бэкэнд, либо когда вы отправляете неправильно составленный или сегментированный `POST`.
* `-2`: Доска не существует. Возникает, если отправлен неполный или неверно составленный "boundary" в HTTP-заголовке, когда пост содержит вложения.
* `-4`: `"Доступ запрещен."` — При постинге из забаненных подсетей из разных стран. С них запрещен постинг везде, кроме `/int/`. Такие страны перечислены на [картинке в треде `2ch-wiper`](https://lolifox.org/rus/res/1405484.html#q1429468): почти вся Латинская Америка, почти вся Африка, Ближний Восток (Монархии Персидского залива, Иран, Ирак, Турция, Сирия, и т.п.), Балканы, Дальний Восток (Китай, Корея, Индия, Филиппины, и т.п.).
* `-5`: `"Капча невалидна."`. Неправильная капча.
* `-6`: `"Постинг запрещён. Бан: <id-бана>. Причина: <причина>."`. Пример ошибки при отправке сообщения из [Tor](https://ru.wikipedia.org/wiki/Tor)-а: id бана — `554455`, причина — `[P] TOR exit node from United States (CMU-DOTCOM)`. Пример причины ошибки при отправке сообщения из-под [прокси](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D0%BA%D1%81%D0%B8-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80) или [VPN](https://ru.wikipedia.org/wiki/VPN)-а: `[W] proxy vpn`. Примеры ошибок в случае бана пользователя за сообщение: `"Постинг запрещён. Бан: 703362. Причина: Фагочатоc //!b. Истекает: Чтв Июн 01 00:00:00 2015."`, `"Постинг запрещён. Бан: 878620. Причина: Общее 10 - Реклама, вредоносные ссылки, попрошайка. Истекает: Птн Фев 01 00:00:00 2018."`, `"Постинг запрещён. Бан: 831265. Причина: [М] Общее 4 - Шитпостинг (Качество контента) //!mg. Истекает: Втр Янв 01 00:00:00 2017."`. ID бана требуется прикладывать при отправке запроса на разбан. Баны могут быть как "локальными" — на одной доске (это можно определить по соответствующей приписке в причине бана, например: `//!b`) — так и "глобальными" (на всех досках).
* `-7`: Тред закрыт.
* `-8`: `"Вы постите слишком быстро."`. Стандартный "кулдаун" на отправку постов на всех досках — 20 секунд, на создание тредов в `/b/` — 20 секунд, в тематиках — 300 секунд. Тут стоит уточнить, что "кулдаун" на создание тредов работает не так, как у на отправку постов, а несколько иначе: он распространяется не на конкретную подсеть IP-адресов, а вообще на всех. То есть, если кто-то создал тред, например, в `/b/`, то в последующие 20 секунд у всех постеров будет выбивать `-8` при попытке создать ещё один тред на этой же доске, вне зависимости от их IP-адреса.
* `-10`: `"Вы загружаете одинаковые файлы."`. Возникает, если в отправляемом сообщении присутствуют одинаковые файлы.
* `-11`: `"Тип файла не поддерживается."`. Возникает, если в отправляемом сообщении присутствуют вложения, тип файлов которых не поддерживается.
* `-13`: Вы запостили слишком много файлов. Возникает при попытке отправить более `4`х вложений в посте (с некоторыми видами пасскодов разрешено до 8 вложений). Возможно бывает также при превышении предела суммарного размера файлов для доски (например, `20` Мб для `/b/`) (но это не точно).
* `-15`: Слишком длинное сообщение. Возникает, если длина комментария превышает максимальную для доски (например, для `/b/` это `15 000` символов).
* `-16`: `"В сообщении присутствует слово из спам листа."`.
* `-20`: Вы ничего не запостили. Возникает при попытке отправить пустое сообщение.

### Создание треда

То же самое, что для отправки сообщения в тред, с тем отличием, что поле формы `thread` в данном случае будет `0`, а также можно добавить поле формы `tags` для добавления "тегов" к создаваемому треду.

Пример ответа без ошибки:

```js
{
  Error: null,
  Status: "Redirect",
  Target: 194366740
}
```

Где:

* `Error` — Код ошибки (в данном случае ошибки не произошло).
* `Status` — Всегда `"Redirect"`.
* `Target` — ID созданного треда.

Возможные коды ошибок:

* Судя по всему, всё то же самое, что и для отправки сообщения в тред.
* `-4`: `"Раздел закрыт."` — если на этой доске не разрешено создание тредов (например, было на доске `/test/`).

## Голосование

На некоторых досках (например, `/po/`) можно голосовать за посты. В этом случае у доски будет поле `enable_likes: 1`. У объекта Post в этом случае добавятся поля `likes: число` и `dislikes: число`.

Для отправки голоса за сообщение отправляется `GET` запрос по адресу `https://2ch.hk/makaba/likes.fcgi?task=<действие>&board=<id-доски>&num=<id-поста>`, где `<действие>` — это либо `like`, либо `dislike`.

Пример ответа без ошибки:

```js
{
  "Error": null,
  "Status": "OK"
}
```

Пример ответа с ошибкой:

```js
{
  "Error": -4,
  "Reason": "Вы уже двачевали этот пост."
}
```

### Пасскод

"Пасскоды" имеют вид строки (случайным образом сгенерированный "хеш" код), и представляют собой форму добровольного пожертвования сайту `2ch.hk` в обмен на бо́льшие удобства (возможность постинга без капчи, возможность прикреплять большие файлы, возможность постить с зарубежных прокси/VPN).

Для [входа](https://2ch.hk/2ch/) с "пасскодом" отправляется GET запрос по адресу `https://2ch.hk/makaba/makaba.fcgi` с параметрами:

* `task` — `"auth"`
* `usercode` — пасскод
* `json` — `1`

Пример ответа без ошибки:

```js
{
  // Максимальное количество прикрепляемых файлов.
  files: 4

  // Максимальный размер прикрепляемого файла.
  files_size: 40960

  // Какой-то "хеш".
  hash: "5c5e915ae9b..."

  // Максимальная ширина/высота прикрепляемой картинки.
  max_image_resolution: 40960

  // Код ответа. Если не возникло ошибки — `1`.
  result: 1

  // Срок годности "пасскода".
  type: "year"
}
```

После успешного применения пасскода сервером `2ch.hk` проставляется cookie `passcode_auth` со случайно сгенерированным "хешем" (не совпадающим с `hash`, полученным в ответе). Значение этой cookie следует записывать в поле `usercode` при отправке сообщения или создании треда: так сервер `2ch.hk` определит, что сообщение отправлено с "пасскодом".

Пример ответа с ошибкой:

```js
{
  // Текст ошибки.
  description: "Ваш код не существует!",

  // Код ошибки.
  // `4` — Нет такого пасскода.
  error: 4,

  // Код ответа. Если возникла ошибка — `0`.
  result: 0
}
```

## Прочее

### Разделы 18+

Доступ в разделы "18+" разрешён только для запросов, имеющих cookie `usercode_auth`. Эта cookie устанавливается сама при ответе в любой тред на любой доске.

### ОП треда

У форм отправки сообщения в тред и создания треда есть галка "ОП треда". Эта галка может быть использована автором треда для публичного подтверждения своего авторства при последующих ответах в такой тред. При создании треда с галкой "ОП треда" сервер `2ch.hk` создаёт cookie вида `op_<id-доски>_<id-треда>` со случайным хешем (например, `op_mg_412244: "5a2ac8be2534b02e818cc4020d69677f"`). При последующих ответах в такой тред с галкой "ОП треда" сервер будет сравнивать отправленную cookie с записанной на сервере, что позволит установить подлинность автора треда.

### Флаги

Если у доски `"enable_flags": 1` (например, на доске `/int/`), то у всех постов будет поле `icon`:

```js
{
  "icon": "<img hspace=\"3\" src=\"/flags/KR.png\" border=\"0\" />"
}
```

Есть пара странных флагов: `"A1.png"` и `"A2.png"`. Возможно, они для обозначения [Tor](https://ru.wikipedia.org/wiki/Tor)'а.

### Значки

На некоторых досках (например, `/po/`) при отправке сообщения можно выбрать значок, который будет прикреплён к отправляемому сообщению (ID значка — число). ID значка можно взять из поля `icons` JSON объекта с данными доски. Пример:

```js
{
  "icon": "<img hspace=\"3\" src=\"/icons/logos/gay.png\" title=\"ЛГБТ\" border=\"0\" />"
}
```

Один раз я видел исключение, когда это была не `.png` картинка. Этим исключением был значок Крыма: `krym.gif`.

### ID пользователей

На некоторых досках (например, `/po/`) показываются ID пользователей (являющиеся хешами их IP адресов). Хеш IP адреса будет представлен как в виде цвета автора сообщения, так и в виде самого случайно сгенерированного имени автора сообщения (у автора основного сообщения треда не будет цвета и имени). Примеры:

```js
{
  "name": "Аноним&nbsp;ID:&nbsp;Heaven"
}
```

```js
{
  "name": "Аноним&nbsp;ID:&nbsp;<span id=\"id_tag_7ab0a33a\" style=\"color:rgb(116,48,218);\">Насмешливый&nbsp;Обеликс</span>"
}
```

### Автогенерирование тем

На некоторых досках (например: `/b/`, `/rf/`) зачем-то нет поля "Темы" при создании треда или отправке сообщения. В этих случаях тема зачем-то генерируется сама. Судя по всему, алгоритм какой-то такой: все `<br>`'ы заменяются на пробелы, а все остальные теги — убираются.

```js
comment.replace(/<br>/g, ' ').replace(/<.+?>/g, '')
```

### Идентификация ОП

При создании темы можно ставить галку "ОП". В этом случае система запишет, что тред создан пользователем с таким-то хешем IP адреса. Если при ответе в такой тред снова поставить галку "ОП", и в случае, если хеш IP адреса отвечающего совпадёт с хешем IP адреса создавшего тред, то у поста будет поле `"op": 1`. Таким образом "ОП" (original poster) (автор треда) может идентифицировать себя в треде.

### Email

Автор сообщения может вписать в поле "Имя" свою почту, и тогда у поста будет поле `"email": "mailto:..."` с этим электронным адресом. Если в поле "Имя" было вписано ["sage"](https://knowyourmeme.com/memes/sage) (также называемая "сажей"), то у поста будет поле `"email": "mailto:sage"`, и такой пост не будет "бампать" (поднимать) тред.

### Трипкоды

Поле `trip` у поста.

"Трипкоды" привелегированных пользователей:

* `"!!%adm%!!"` — Администратор.
* `"!!%mod%!!"` — Модератор.

Обычные пользователи (т.н. "трипфаги") также могут использовать "трипкоды" для самоидентификации. Пример: `"!!5pvF7WEJc."`.

### Стикеры.

Список стикеров - https://2ch.hk/makaba/stickers/

Добавить свой стикер пак - https://2ch.hk/makaba/stickers/editor

После создания стикер пака и загрузки изображений, необходимо нажать "Активировать", чтобы стикер пак был доступен всем для поиска.

Стикер паки владелец может обновлять, добавлять и удалять из них стикеры, а также удалить вовсе.
Измененный пак обновляется автоматически раз в сутки или можете обновить вручную, если видите что в нем появились новые изображения, нажав в окошке со стикерами U

Стикер вызывается через кнопку S в окошке поста.

Один пост = один стикер. Можно добавлять .gif, которые автоматически проигрываются в превью. .png автоматически отображаются прозрачными.

Стикеры доступны как для анонов (можно использовать до 5 паков), так и для пасскодобояр (без лимита).

Создавать паки могут абсолютно все.

Для загрузки изображение PNG/GIF должно вписываться в квадрат 512x512 (одна сторона — от 200 до 512 пикселей, другая — 512 или меньше, но не менее 50)